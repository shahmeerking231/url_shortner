<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <title>Home</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html,
      body {
        width: 100%;
        height: 100vh;
      }
      #toast {
        width: 20vw;
        height: 10vh;
        box-shadow: 5px 5px 10px rgba(0, 0, 0, 0.3);
        position: absolute;
        bottom: 5%;
        right: 2%;
        border-radius: 20px;
        display: none;
        align-items: center;
        justify-content: center;
        background-color: #212529;
        color: white;
      }
    </style>
  </head>

  <body>
    <nav class="navbar navbar-dark bg-dark px-4 py-4">
      <a class="navbar-brand font-weight-bolder">URL Shortner</a>
      <form class="">
        <button class="btn btn-outline-success my-2 my-sm-0" type="submit">
          Hello User!
        </button>
      </form>
    </nav>
    <main
      class="w-100 h-auto mt-4 d-flex justify-content-center align-items-center flex-column"
    >
      <form
        class="w-50 input-group d-flex flex-row justify-content-around"
        action="/url"
        method="POST"
      >
        <input
          type="text"
          class="form-control mx-2"
          placeholder="URL"
          name="url"
        />
        <button class="btn btn-outline-secondary" type="reset">Clear</button>
        <button class="btn btn-outline-secondary" type="submit">
          Short URL
        </button>
      </form>
      <div class="d-flex bd-highlight mt-4 w-50 h-auto align-items-center">
        <% if(locals.id) { %> URL Generated:
        <a
          id="copy-url"
          class="p-2 bd-highlight"
          href="http://:8000/url/<%=id%>"
          >http://localhost:8000/url/<%=id%></a
        >
        <% }%>
      </div>
    </main>

    <div id="toast"></div>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
      integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
      crossorigin="anonymous"
    ></script>
    <script>
      const copyUrl = document.getElementById("copy-url");
      const urlToCopy = copyUrl.innerText;
      const toastElm = document.getElementById("toast");

      function toast(text) {
        toastElm.innerText = text;
        toastElm.style.display = "flex";
        setTimeout(() => {
          toastElm.style.display = "none";
        }, 2500);
      }

      async function copyToClipboard(text) {
        try {
          await navigator.clipboard.writeText(text);
          toast("Text successfully copied to clipboard!");
        } catch (err) {
          toast(`Failed to copy text: ${err}`);
        }
      }

      copyUrl.addEventListener("click", (e) => {
        e.preventDefault();
        copyToClipboard(urlToCopy);
      });
    </script>
  </body>
</html>
